<div class="gn-related-resources gn-info-list-blocks"
      data-ng-if="relationFound">
  <h2>{{::title}}</h2>

  <div class=""
       data-ng-repeat="(type, items) in relations track by $index"
       data-ng-if="layout !== 'card' && layout !== 'title'
                   && type && type !== 'thumbnails'">
    <div data-ng-init="mainType = config.getType(r, type);
                       badge = config.getBadgeLabel(mainType, r);
                       icon = config.getClassIcon(mainType);"
         class="row list-group-item gn-related-item gn-related-{{type}} gn-relation-type-{{mainType}}"
         data-ng-repeat="r in items track by $index">
      <div class="gn-related-icon-col col-xs-2 col-sm-2 text-center">
        <strong>
          <div class="clearfix">
            <i class="fa"
               data-ng-class="icon"/>
          </div>
          <span data-ng-if="badge != ''"
                class="label label-default"
                data-ng-class="{
                  'label-primary': icon === 'fa-download' || icon === 'fa-file-pdf-o',
                  'label-success': icon === 'fa-globe'}">{{badge}}</span>
        </strong>
      </div>
      <div data-ng-class="mainType === 'MDFCATS' ? 'col-xs-11' : 'col-xs-7 col-sm-7'">
        <!-- Always display title if available -->
        <h3 data-ng-if="::(r.title | gnLocalized: lang).length">
          <a data-ng-href="{{r.url | gnLocalized: lang}}">
            {{::(r.title | gnLocalized: lang)}}
          </a>
        </h3>
        <!-- Display description if available -->
        <p data-ng-if="(mainType === 'WMS' || mainType === 'WMSSERVICE' ||
                       mainType === 'WMTS' || mainType === 'WMTSSERVICE' ||
                       mainType === 'WCS' ||
                       mainType.indexOf('LINK') === 0 ||
                       mainType.indexOf('DEFAULT') === 0 ||
                       r.protocol === 'OGC:WFS') &&
                       r.locDescription.length > 0  &&
                      mainType !== 'LINK'">
          {{::r.locDescription | striptags | characters:150}}
        </p>
        <div data-ng-switch on="mainType">
          <div data-ng-switch-when="WMS">
            <p class="text-muted">
              <span data-translate=""
                    data-translate-values="{url:'{{r.url | gnLocalized: lang}}', layer:'{{(r.title | gnLocalized: lang).replaceAll('\'', '\\\'')}}'}">
                wmsLinkDetails</span>
            </p>
          </div>
          <div data-ng-switch-when="WMTS">
            <p class="text-muted">
              <span data-translate=""
                    data-translate-values="{url:'{{r.url | gnLocalized: lang}}', layer:'{{(r.title | gnLocalized: lang).replaceAll('\'', '\\\'')}}'}">
                wmtsLinkDetails</span>
            </p>
          </div>
          <div data-ng-switch-when="WMSSERVICE">
            <p class="text-muted">
              <span data-translate=""
                    data-translate-values="{url:'{{r.url | gnLocalized: lang}}'}">
                wmsServiceLinkDetails</span>
            </p>
          </div>
          <div data-ng-switch-when="WMTSSERVICE">
            <p class="text-muted">
              <span data-translate=""
                    data-translate-values="{url:'{{r.url | gnLocalized: lang}}'}">
                wmtsServiceLinkDetails</span>
            </p>
          </div>
          <div data-ng-switch-when="WFS">
            <p class="text-muted"
               data-ng-if="isLayerProtocol(r)">
              <span data-translate=""
                    data-translate-values="{url:'{{r.url | gnLocalized: lang}}', layer:'{{r.title | gnLocalized: lang}}'}">
                wfsLinkDetails</span>
            </p>
            <div data-ng-if="isLayerProtocol(r)"
                 data-gn-no-map-wfs-download=""
                 data-typename="{{r.title | gnLocalized: lang}}"
                 data-url="{{r.url | gnLocalized: lang}}">
            </div>

            <p class="text-muted"
               data-ng-if="!isLayerProtocol(r)">
              <span data-translate=""
                    data-translate-values="{url:'{{r.url | gnLocalized: lang}}'}">
                wfsServiceLinkDetails</span>
            </p>
            <div data-ng-if="!isLayerProtocol(r)"
                 data-gn-no-map-wfs-download=""
                 data-typename=""
                 data-url="{{r.url | gnLocalized: lang}}">
            </div>
          </div>

          <div data-ng-switch-when="TMS">
            <span data-translate=""
                  data-translate-values="{url:'{{r.url | gnLocalized: lang}}', layer:'{{r.title | gnLocalized: lang}}'}">
              tmsLinkDetails</span>
          </div>

          <div data-ng-switch-when="SOS">
            <span data-translate=""
                  data-translate-values="{url:'{{r.url | gnLocalized: lang}}', layer:'{{r.title | gnLocalized: lang}}'}">
              sosLinkDetails</span>
          </div>

          <div data-ng-switch-when="ESRI:REST">
            <span data-translate=""
                  data-translate-values="{url:'{{r.url | gnLocalized: lang}}', layer:'{{r.title | gnLocalized: lang}}'}">
              esriRestLinkDetails</span>
          </div>

          <div data-ng-switch-when="WCS">
            <p class="text-muted">
            <span data-translate=""
                  data-translate-values="{url:'{{r.url | gnLocalized: lang}}', layer:'{{r.title | gnLocalized: lang}}'}">
              wcsLinkDetails</span>
            </p>
          </div>

          <div data-ng-switch-when="ATOM">
            <p class="text-muted" data-translate=""
               data-translate-values="{url:'{{r.url | gnLocalized: lang}}', layer:'{{r.title | gnLocalized: lang}}'}">
              atomLinkDetails
            </p>
            <div
              data-gn-atom-download="r.title"
              data-layer-name="{{r.title | gnLocalized: lang}}"
              data-url="{{r.url | gnLocalized: lang}}"
              data-md="md">
            </div>
          </div>

          <div data-ng-switch-when="DB">
            <p class="text-muted">
            <span data-translate=""
                  data-translate-values="{url:'{{(r.url | gnLocalized: lang).replaceAll('\\', '\\\\')}}', layer:'{{r.title | gnLocalized: lang}}'}">
              databaseLayerDetails</span>
            </p>
          </div>

          <div data-ng-switch-when="FILE">
            <p class="text-muted">
              <span data-translate=""
                    data-translate-values="{url:'{{(r.url | gnLocalized: lang).replaceAll('\\', '\\\\')}}', name:'{{r.title | gnLocalized: lang}}'}">
                fileLayerDetails</span>
              <input class="form-control"
                     type="text"
                     onClick="this.setSelectionRange(0, this.value.length)"
                     value="{{::r.url | gnLocalized: lang}}"/>
            </p>
          </div>

          <div data-ng-switch-when="MDFCATS"
               data-ng-if="r.featureType">
            <p data-translate="">technicalInformation</p>
            <div data-gn-attribute-table-renderer="r.featureType.attributeTable.element">
            </div>
          </div>

          <div data-ng-switch-default>
            <p class="text-muted"
               data-ng-if="mainType.indexOf('MD') == 0 && r.id"
               data-ng-init="hasDescription = r.description && (r.description | gnLocalized: lang).length > 0;">
              <span class="gn-related-description"
                    data-ng-show="hasDescription">
                {{ (r.description | gnLocalized: lang | striptags | words:35)}} <a data-ng-click="config.showMore(r, md)" href="">{{'more' |
                translate}}...</a>
              </span>
              <span data-ng-show="!hasDescription"
                    ng-bind-html="r.url | gnLocalized: lang | linky:'_blank'"></span>
            </p>

            <p class="text-muted"
               data-ng-if="mainType.indexOf('MD') == -1">
              <span class="gn-related-description" data-ng-if="r.description">
                {{ (r.description | gnLocalized: lang | striptags)}}</a>
              </span>
<!--              <span ng-bind-html="r.url | gnLocalized: lang | linky:'_blank'"></span>-->
            </p>
          </div>
        </div>
      </div>

      <div class="col-xs-12 col-sm-3">
        <div data-gn-record-links-button="[r]"
             data-type="type"
             data-icon-mode="none"
             data-btn-class="btn-sm btn-block"
             data-record="md">
        </div>

        <button type="button"
                class="btn btn-default btn-sm btn-block gn-btn-addtoexternal text-wrap"
                data-ng-if="externalViewerActionEnabled
                          && (mainType === 'WMS' || mainType === 'WMSSERVICE')"
                data-ng-click="externalViewerAction(mainType, r, md)"
                data-translate="">viewInExternalViewer</button>
      </div>

    </div>
  </div>

  <ul class=""
      data-ng-repeat="(type, items) in relations track by $index"
      data-ng-if="layout === 'title' && type && type !== 'thumbnails' && type !== 'onlines'"
      data-ng-init="mainType = config.getType(md, type);
                    badge = config.getBadgeLabel(mainType, md);
                    icon = config.getClassIcon(mainType);" >
    <li data-ng-repeat="md in items | orderBy:'record.resourceTitle'">
      <a href=""
         title="{{md.record.resourceTitle}}"
         gn-metadata-open="md.record"
         gn-formatter="formatter.defaultUrl">
        {{md.record.resourceTitle}}
      </a>
    </li>
  </ul>

  <ul class="row list-group gn-info-list"
      data-ng-repeat="(type, items) in relations track by $index"
      data-ng-if="layout === 'card' && type && type !== 'thumbnails' && type !== 'onlines'"
      data-ng-init="mainType = config.getType(md, type);
                    badge = config.getBadgeLabel(mainType, md);
                    icon = config.getClassIcon(mainType);" >
    <gn-metadata-card data-ng-repeat="md in items | orderBy:'record.resourceTitle'"
                      md="md.record"
                      formatter-url="formatter.defaultUrl">
      <span class="label label-default gn-card-badge"
            data-ng-class="{
            'gn-card-series': type === 'parent',
            'gn-card-nonGeographicDataset': type === 'nonGeographicDataset',
            'gn-card-service': type === 'services' || type === 'application',
            'gn-card-dataset': type !== 'parent' && type !== 'services' && type !== 'application' && type !== 'nonGeographicDataset'
            }">
        <i class="fa {{icon}}"/>
        {{(config.getLabel(mainType, type)) | translate}}
      </span>
    </gn-metadata-card>
  </ul>
</div>
